# 1. Read behavioral Verilog
read_verilog 1-test.v

# 2. Set top module
hierarchy -top static_key_leak

# 3. Convert always blocks into RTLIL processes
proc

# 4. Flatten hierarchy
flatten

# 5. Read Nangate 45 Liberty library
read_liberty -lib "C:/_1/Uni-Files/2025/S2/Topics in Computer Science/projectfiles/lib/NangateOpenCellLibrary_typical.lib"

# 6. Map DFFs to library DFFs (async reset)
dfflibmap -liberty "C:/_1/Uni-Files/2025/S2/Topics in Computer Science/projectfiles/lib/NangateOpenCellLibrary_typical.lib"

# 7. Legalize DFFs to types supported by Yosys/ABC
dfflegalize   # <- NO -liberty here

# 8. Map combinational logic to library gates
abc -liberty "C:/_1/Uni-Files/2025/S2/Topics in Computer Science/projectfiles/lib/NangateOpenCellLibrary_typical.lib"

# 9. Clean up and optimize
opt_clean
opt

# 10. Write out gate-level netlist
write_verilog -noattr 3netlist.v
